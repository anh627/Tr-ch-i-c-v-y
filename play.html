<!doctype html>
<html lang="vi" data-lang="vi" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChÆ¡i Cá» VÃ¢y â€“ GoMaster</title>
  <meta name="description" content="ChÆ¡i Cá» VÃ¢y 9Ã—9/13Ã—13/19Ã—19 vá»›i AI hoáº·c 2 ngÆ°á»i, cÃ³ gá»£i Ã½, undo vÃ  tÃ³m táº¯t sau vÃ¡n." />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#f59e0b" />
  <!-- Open Graph -->
  <meta property="og:site_name" content="GoMaster" />
  <meta property="og:title" content="ChÆ¡i Cá» VÃ¢y â€“ GoMaster" />
  <meta property="og:description" content="Thiáº¿t láº­p luáº­t, komi, báº­t/táº¯t ranked vÃ  chÆ¡i vá»›i AI nhiá»u má»©c Ä‘á»™." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="vi_VN" />
  <meta property="og:image" content="assets/images/og-cover.png" />
  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ChÆ¡i Cá» VÃ¢y â€“ GoMaster" />
  <meta name="twitter:description" content="Thiáº¿t láº­p luáº­t, komi, báº­t/táº¯t ranked vÃ  chÆ¡i vá»›i AI nhiá»u má»©c Ä‘á»™." />
  <meta name="twitter:image" content="assets/images/og-cover.png" />
  <!-- Icons & PWA -->
  <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="assets/images/apple-touch-icon.png" />
  <link rel="manifest" href="manifest.json" />
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Styles -->
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="stylesheet" href="styles/play.css" />
</head>
<body data-page="play">
  <a class="skip-link" href="#main"><span class="lang-vi">Bá» qua tá»›i ná»™i dung chÃ­nh</span><span class="lang-en">Skip to main content</span></a>

  <header class="topbar" role="banner">
    <a class="brand" href="index.html">
      <span class="brand-icon">âš«âšª</span>
      <span>GoMaster</span>
    </a>
    <nav class="nav" aria-label="Äiá»u hÆ°á»›ng chÃ­nh">
      <a href="index.html"><span class="lang-vi">ğŸ  Trang chá»§</span><span class="lang-en">Home</span></a>
      <a href="learn.html"><span class="lang-vi">ğŸ“š Há»c</span><span class="lang-en">Learn</span></a>
      <a href="play.html" aria-current="page" class="nav-active"><span class="lang-vi">ğŸ® ChÆ¡i</span><span class="lang-en">Play</span></a>
      <a href="analysis.html"><span class="lang-vi">ğŸ“Š PhÃ¢n tÃ­ch</span><span class="lang-en">Analysis</span></a>
      <a href="ranking.html"><span class="lang-vi">ğŸ† Xáº¿p háº¡ng</span><span class="lang-en">Ranking</span></a>
      <a href="profile.html"><span class="lang-vi">ğŸ‘¤ Há»“ sÆ¡</span><span class="lang-en">Profile</span></a>
      <button id="themeToggle" class="btn ghost" type="button" aria-label="Äá»•i cháº¿ Ä‘á»™ sÃ¡ng/tá»‘i" aria-pressed="false" title="Äá»•i cháº¿ Ä‘á»™ sÃ¡ng/tá»‘i">ğŸŒ—</button>
    </nav>
  </header>

  <main id="main" class="container play" itemscope itemtype="http://schema.org/Game">
    <meta itemprop="name" content="GoMaster Play" />
    <meta itemprop="description" content="ChÆ¡i cá» vÃ¢y 9Ã—9/13Ã—13/19Ã—19 vá»›i AI hoáº·c 2 ngÆ°á»i, tÃ¹y chá»‰nh luáº­t vÃ  komi." />

    <section class="left" aria-labelledby="playBoardLabel">
      <div class="board-header">
        <h1 id="playBoardLabel">
          <span class="board-icon">ğŸ¯</span>
          <span class="lang-vi">BÃ n chÆ¡i</span><span class="lang-en">Game Board</span>
          <span class="live-indicator"><span class="live-dot"></span><span class="live-text"><span class="lang-vi">Live</span><span class="lang-en">Live</span></span></span>
        </h1>
        <div class="game-info">
          <div class="player-info black-player">
            <span class="player-stone">âš«</span>
            <span class="player-name"><span class="lang-vi">Äen</span><span class="lang-en">Black</span></span>
            <span class="player-captures" id="blackCaptures">0</span>
          </div>
          <div class="vs-divider"><span class="lang-vi">VS</span><span class="lang-en">VS</span></div>
          <div class="player-info white-player">
            <span class="player-stone">âšª</span>
            <span class="player-name"><span class="lang-vi">Tráº¯ng</span><span class="lang-en">White</span></span>
            <span class="player-captures" id="whiteCaptures">0</span>
          </div>
        </div>
        <!-- ThÃªm timer cho má»—i lÆ°á»£t -->
        <div class="timer" id="timer"><span class="lang-vi">Thá»i gian: </span><span class="lang-en">Time: </span>05:00</div>
      </div>

      <p id="playBoardHelp" class="sr-only">
        <span class="lang-vi">Äiá»u khiá»ƒn bÃ n: chuá»™t Ä‘á»ƒ Ä‘áº·t quÃ¢n, mÅ©i tÃªn Ä‘á»ƒ di chuyá»ƒn, Enter Ä‘á»ƒ Ä‘áº·t, Backspace/Undo Ä‘á»ƒ hoÃ n tÃ¡c, P Ä‘á»ƒ Pass.</span>
        <span class="lang-en">Board controls: Use mouse to place stones, arrow keys to move, Enter to place, Backspace/Undo to undo, P to Pass.</span>
      </p>

      <div class="board-container">
        <canvas id="playBoard" width="640" height="640" tabindex="0" aria-label="BÃ n chÆ¡i" aria-describedby="playBoardHelp">
          <div class="canvas-fallback">
            <p><span class="lang-vi">TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ canvas.</span><span class="lang-en">Your browser does not support canvas.</span></p>
            <img src="assets/images/board-fallback.png" alt="HÃ¬nh áº£nh bÃ n cá» vÃ¢y máº«u" />
          </div>
        </canvas>
        <!-- ThÃªm hÃ¬nh áº£nh tá»« index -->
        <img src="assets/images/go-board-hero.jpg" alt="BÃ n cá» VÃ¢y minh há»a" class="board-image" width="200" height="200" loading="lazy">
      </div>

      <div class="board-actions">
        <button id="btnPass" class="btn secondary" type="button" title="Bá» lÆ°á»£t (Pass)"><span class="btn-icon">â­ï¸</span><span class="lang-vi">Pass</span><span class="lang-en">Pass</span></button>
        <button id="btnResign" class="btn danger" type="button" title="Äáº§u hÃ ng vÃ¡n nÃ y"><span class="btn-icon">ğŸ³ï¸</span><span class="lang-vi">Äáº§u hÃ ng</span><span class="lang-en">Resign</span></button>
        <button id="btnHint" class="btn ghost" type="button" title="Gá»£i Ã½ nÆ°á»›c Ä‘i"><span class="btn-icon">ğŸ’¡</span><span class="lang-vi">Gá»£i Ã½</span><span class="lang-en">Hint</span></button>
        <button id="btnUndo" class="btn ghost" type="button" title="HoÃ n tÃ¡c nÆ°á»›c Ä‘i gáº§n nháº¥t"><span class="btn-icon">â†©ï¸</span><span class="lang-vi">Undo</span><span class="lang-en">Undo</span></button>
      </div>

      <div class="statusbar" id="playStatus" role="status" aria-live="polite">
        <div class="status-content"><span class="status-icon">âœ¨</span><span class="status-text"><span class="lang-vi">Sáºµn sÃ ng chiáº¿n Ä‘áº¥u!</span><span class="lang-en">Ready to battle!</span></span></div>
      </div>
    </section>

    <section class="right" aria-labelledby="playSettingsTitle">
      <div class="settings-header">
        <h2 id="playSettingsTitle"><span class="settings-icon">âš™ï¸</span><span class="lang-vi">Thiáº¿t láº­p tráº­n Ä‘áº¥u</span><span class="lang-en">Game Settings</span></h2>
        <div class="settings-badge"><span class="badge-icon">ğŸ¯</span><span class="lang-vi">TÃ¹y chá»‰nh</span><span class="lang-en">Customizable</span></div>
        <!-- ThÃªm hÃ¬nh áº£nh tá»« index -->
        <img src="assets/images/go-pro-analysis.jpg" alt="Thiáº¿t láº­p tráº­n Ä‘áº¥u minh há»a" class="settings-image" width="150" height="100" loading="lazy">
      </div>

      <div class="form">
        <div class="form-group">
          <label for="boardSize"><span class="label-icon">ğŸ“</span><span class="lang-vi">KÃ­ch thÆ°á»›c:</span><span class="lang-en">Board Size:</span></label>
          <select id="boardSize" class="select-enhanced">
            <option value="9"><span class="lang-vi">ğŸŒ± 9Ã—9 (Newbie)</span><span class="lang-en">9Ã—9 (Newbie)</span></option>
            <option value="13" selected><span class="lang-vi">ğŸ® 13Ã—13 (Casual)</span><span class="lang-en">13Ã—13 (Casual)</span></option>
            <option value="19"><span class="lang-vi">ğŸ† 19Ã—19 (Pro)</span><span class="lang-en">19Ã—19 (Pro)</span></option>
          </select>
        </div>

        <div class="form-group">
          <label for="ruleSet"><span class="label-icon">ğŸ“‹</span><span class="lang-vi">Luáº­t:</span><span class="lang-en">Rules:</span></label>
          <select id="ruleSet" class="select-enhanced">
            <option value="chinese" selected><span class="lang-vi">ğŸ‡¨ğŸ‡³ Chinese (Area)</span><span class="lang-en">Chinese (Area)</span></option>
            <option value="japanese"><span class="lang-vi">ğŸ‡¯ğŸ‡µ Japanese (Territory)</span><span class="lang-en">Japanese (Territory)</span></option>
          </select>
        </div>

        <div class="form-group">
          <label for="komi"><span class="label-icon">âš–ï¸</span><span class="lang-vi">Komi:</span><span class="lang-en">Komi:</span></label>
          <input type="number" id="komi" value="6.5" step="0.5" min="0" inputmode="decimal" class="input-enhanced" />
        </div>

        <div class="form-group">
          <label for="opponentType"><span class="label-icon">ğŸ¤–</span><span class="lang-vi">Äá»‘i thá»§:</span><span class="lang-en">Opponent:</span></label>
          <select id="opponentType" class="select-enhanced">
            <option value="ai" selected><span class="lang-vi">ğŸ¤– AI</span><span class="lang-en">AI</span></option>
            <option value="hotseat"><span class="lang-vi">ğŸ‘¥ 2 ngÆ°á»i (cÃ¹ng mÃ¡y)</span><span class="lang-en">2 Players (Hotseat)</span></option>
          </select>
        </div>

        <div id="aiOptions" class="form-group">
          <label for="aiLevel"><span class="label-icon">ğŸšï¸</span><span class="lang-vi">Äá»™ khÃ³ AI:</span><span class="lang-en">AI Difficulty:</span></label>
          <select id="aiLevel" class="select-enhanced">
            <option value="easy"><span class="lang-vi">ğŸ˜Š Dá»… (Newbie)</span><span class="lang-en">Easy (Newbie)</span></option>
            <option value="normal" selected><span class="lang-vi">ğŸ˜ Trung bÃ¬nh (Casual)</span><span class="lang-en">Normal (Casual)</span></option>
            <option value="hard"><span class="lang-vi">ğŸ˜¤ KhÃ³</span><span class="lang-en">Hard</span></option>
            <option value="pro"><span class="lang-vi">ğŸ”¥ Pro</span><span class="lang-en">Pro</span></option>
          </select>
        </div>

        <div class="form-group">
          <label class="switch-label" for="rankedToggle">
            <input type="checkbox" id="rankedToggle" aria-describedby="rankedHintText" />
            <span class="switch-slider"></span>
            <span class="switch-text"><span class="switch-icon">ğŸ†</span><span class="lang-vi">Ranked (tÃ­nh Ä‘iá»ƒm kyu/dan)</span><span class="lang-en">Ranked (kyu/dan scoring)</span></span>
          </label>
          <small id="rankedHintText" class="hint-text"><span class="lang-vi">âš ï¸ Khi báº­t Ranked, chá»©c nÄƒng gá»£i Ã½ sáº½ bá»‹ khÃ³a.</span><span class="lang-en">âš ï¸ Hints are disabled in Ranked mode.</span></small>
        </div>

        <div class="form-group">
          <label class="switch-label" for="showCoords">
            <input type="checkbox" id="showCoords" checked />
            <span class="switch-slider"></span>
            <span class="switch-text"><span class="switch-icon">ğŸ—ºï¸</span><span class="lang-vi">Hiá»‡n tá»a Ä‘á»™</span><span class="lang-en">Show Coordinates</span></span>
          </label>
        </div>

        <div class="form-group">
          <label class="switch-label" for="showLiberties">
            <input type="checkbox" id="showLiberties" />
            <span class="switch-slider"></span>
            <span class="switch-text"><span class="switch-icon">ğŸ’¨</span><span class="lang-vi">Hiá»‡n khÃ­</span><span class="lang-en">Show Liberties</span></span>
          </label>
        </div>

        <button id="btnStart" class="btn primary large" type="button"><span class="btn-icon">ğŸš€</span><span class="lang-vi">Báº¯t Ä‘áº§u vÃ¡n</span><span class="lang-en">Start Game</span></button>
      </div>

      <div class="summary" aria-labelledby="postGameTitle">
        <div class="summary-header">
          <h3 id="postGameTitle"><span class="summary-icon">ğŸ“Š</span><span class="lang-vi">TÃ³m táº¯t sau vÃ¡n</span><span class="lang-en">Post-Game Summary</span></h3>
          <!-- ThÃªm hÃ¬nh áº£nh tá»« index -->
          <img src="assets/images/go-pro-analysis.jpg" alt="TÃ³m táº¯t sau vÃ¡n minh há»a" class="summary-image" width="150" height="100" loading="lazy">
        </div>
        <div id="postGameSummary" role="region" aria-live="polite" class="summary-content">
          <div class="empty-state"><span class="empty-icon">ğŸ¯</span><span class="lang-vi">ChÆ°a cÃ³ vÃ¡n nÃ o. HÃ£y báº¯t Ä‘áº§u chÆ¡i!</span><span class="lang-en">No games yet. Start playing!</span></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-brand"><span class="brand-icon">âš«âšª</span><span>GoMaster</span>
        <!-- ThÃªm hÃ¬nh áº£nh tá»« index -->
        <img src="assets/images/go-logo-small.png" alt="Logo GoMaster" class="footer-logo" width="50" height="50" loading="lazy">
      </div>
      <div class="footer-links">
        <a href="#about" class="footer-link"><span class="link-icon">â„¹ï¸</span><span class="lang-vi">Vá» chÃºng tÃ´i</span><span class="lang-en">About Us</span></a>
        <a href="#contact" class="footer-link"><span class="link-icon">ğŸ“§</span><span class="lang-vi">LiÃªn há»‡</span><span class="lang-en">Contact</span></a>
        <a href="#help" class="footer-link"><span class="link-icon">â“</span><span class="lang-vi">Trá»£ giÃºp</span><span class="lang-en">Help</span></a>
      </div>
      <div class="footer-tip">
        <span class="tip-icon">ğŸ’¡</span>
        <small><span class="lang-vi"><strong>Tip:</strong> Gá»£i Ã½ bá»‹ khÃ³a khi báº­t Ranked Ä‘á»ƒ Ä‘áº£m báº£o cÃ´ng báº±ng! âš–ï¸</span><span class="lang-en"><strong>Tip:</strong> Hints are disabled in Ranked mode for fairness! âš–ï¸</span></small>
      </div>
      <div class="footer-encouragement">
        <span class="encourage-icon">ğŸ”¥</span>
        <small><span class="lang-vi">ChÃºc báº¡n cÃ³ nhá»¯ng vÃ¡n Ä‘áº¥u thÃº vá»‹!</span><span class="lang-en">Enjoy exciting games!</span></small>
      </div>
      <div class="footer-bottom">
        <small class="copyright">
          <span class="copyright-icon">Â©</span>
          <span class="lang-vi">2025 GoMaster. Made with <span class="heart-icon">â¤ï¸</span> for Go community in Vietnam <span class="flag-icon">ğŸ‡»ğŸ‡³</span></span>
          <span class="lang-en">2025 GoMaster. Made with <span class="heart-icon">â¤ï¸</span> for Go community <span class="flag-icon">ğŸŒ</span></span>
        </small>
      </div>
    </div>
  </footer>

  <audio id="sfxPlace" src="assets/sounds/stone-place.mp3" preload="auto" aria-describedby="sfxPlaceDesc"></audio>
  <audio id="sfxCapture" src="assets/sounds/capture.mp3" preload="auto" aria-describedby="sfxCaptureDesc"></audio>
  <div id="sfxPlaceDesc" class="sr-only"><span class="lang-vi">Ã‚m thanh khi Ä‘áº·t quÃ¢n cá».</span><span class="lang-en">Sound when placing a stone.</span></div>
  <div id="sfxCaptureDesc" class="sr-only"><span class="lang-vi">Ã‚m thanh khi báº¯t quÃ¢n Ä‘á»‘i thá»§.</span><span class="lang-en">Sound when capturing opponent's stones.</span></div>

  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-content">
      <div class="loading-spinner"><span class="spinner-icon">âš«</span><span class="spinner-icon">âšª</span></div>
      <p class="loading-text"><span class="loading-icon">ğŸ¤–</span><span class="lang-vi">Äang khá»Ÿi táº¡o vÃ¡n cá»...</span><span class="lang-en">Initializing game...</span></p>
    </div>
  </div>

  <noscript>
    <div class="noscript-message">
      <div class="noscript-content">
        <span class="noscript-icon">âš ï¸</span>
        <h2><span class="lang-vi">JavaScript bá»‹ táº¯t</span><span class="lang-en">JavaScript is disabled</span></h2>
        <p><span class="lang-vi">Trang nÃ y cáº§n JavaScript Ä‘á»ƒ hoáº¡t Ä‘á»™ng Ä‘áº§y Ä‘á»§. Vui lÃ²ng <a href="https://enable-javascript.com/vi/" target="_blank" rel="noopener noreferrer">báº­t JavaScript</a>.</span><span class="lang-en">This page requires JavaScript. Please <a href="https://enable-javascript.com/" target="_blank" rel="noopener noreferrer">enable JavaScript</a>.</span></p>
      </div>
    </div>
  </noscript>

  <!-- JavaScript inline Ä‘á»ƒ lÃ m cho vÃ¡n Ä‘áº¥u hoáº¡t Ä‘á»™ng Ä‘áº§y Ä‘á»§ (minh há»a cÆ¡ báº£n) -->
  <script>
    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      html.setAttribute('data-theme', currentTheme === 'light' ? 'dark' : 'light');
      themeToggle.setAttribute('aria-pressed', currentTheme === 'light' ? 'true' : 'false');
    });

    // Loading Overlay
    const loadingOverlay = document.getElementById('loadingOverlay');
    window.addEventListener('load', () => {
      loadingOverlay.style.display = 'block';
      setTimeout(() => { loadingOverlay.style.display = 'none'; }, 2000);
    });

    // Biáº¿n toÃ n cá»¥c cho vÃ¡n Ä‘áº¥u
    let boardSize = 13; // Máº·c Ä‘á»‹nh
    let board = []; // Máº£ng 2D: 0 rá»—ng, 1 Ä‘en, 2 tráº¯ng
    let currentTurn = 1; // 1: Ä‘en, 2: tráº¯ng
    let mode = 'ai'; // 'ai' hoáº·c 'hotseat'
    let ranked = false; // Táº¯t hint náº¿u true
    let komi = 6.5;
    let ruleSet = 'chinese';
    let aiLevel = 'normal';
    let showCoords = true;
    let showLiberties = false;
    let moveHistory = []; // LÆ°u lá»‹ch sá»­ Ä‘á»ƒ undo
    let lastMove = null; // Äá»ƒ kiá»ƒm tra Ko
    let blackCaptures = 0;
    let whiteCaptures = 0;
    let timerInterval;
    let timeLeft = 300; // 5 phÃºt/lÆ°á»£t (giÃ¢y)

    // Khá»Ÿi táº¡o bÃ n cá»
    function initBoard(size) {
      board = Array.from({length: size}, () => Array(size).fill(0));
      moveHistory = [];
      lastMove = null;
      blackCaptures = 0;
      whiteCaptures = 0;
      currentTurn = 1;
      document.getElementById('blackCaptures').textContent = 0;
      document.getElementById('whiteCaptures').textContent = 0;
      document.getElementById('playStatus').querySelector('.status-text').textContent = 'VÃ¡n báº¯t Ä‘áº§u! LÆ°á»£t Äen.';
      drawBoard();
      startTimer();
    }

    // Váº½ bÃ n cá» trÃªn canvas
    function drawBoard() {
      const canvas = document.getElementById('playBoard');
      const ctx = canvas.getContext('2d');
      const cellSize = canvas.width / boardSize;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = '#000';
      for (let i = 0; i < boardSize; i++) {
        ctx.beginPath();
        ctx.moveTo(i * cellSize + cellSize / 2, cellSize / 2);
        ctx.lineTo(i * cellSize + cellSize / 2, canvas.height - cellSize / 2);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(cellSize / 2, i * cellSize + cellSize / 2);
        ctx.lineTo(canvas.width - cellSize / 2, i * cellSize + cellSize / 2);
        ctx.stroke();
      }
      // Váº½ tá»a Ä‘á»™ náº¿u báº­t
      if (showCoords) {
        ctx.font = '12px Inter';
        ctx.fillStyle = '#888';
        for (let i = 0; i < boardSize; i++) {
          ctx.fillText(String.fromCharCode(65 + i), (i + 0.5) * cellSize, 15);
          ctx.fillText(boardSize - i, 15, (i + 0.5) * cellSize);
        }
      }
      // Váº½ quÃ¢n cá»
      for (let y = 0; y < boardSize; y++) {
        for (let x = 0; x < boardSize; x++) {
          if (board[y][x] === 1) {
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc((x + 0.5) * cellSize, (y + 0.5) * cellSize, cellSize / 2 - 5, 0, 2 * Math.PI);
            ctx.fill();
          } else if (board[y][x] === 2) {
            ctx.fillStyle = '#fff';
            ctx.strokeStyle = '#000';
            ctx.beginPath();
            ctx.arc((x + 0.5) * cellSize, (y + 0.5) * cellSize, cellSize / 2 - 5, 0, 2 * Math.PI);
            ctx.fill();
            ctx.stroke();
          }
          // Minh há»a hiá»‡n khÃ­ (sá»‘ ngáº«u nhiÃªn náº¿u báº­t)
          if (showLiberties && board[y][x] !== 0) {
            ctx.fillStyle = '#f00';
            ctx.font = '10px Inter';
            ctx.fillText(Math.floor(Math.random() * 4 + 1), (x + 0.5) * cellSize, (y + 0.5) * cellSize + 5);
          }
        }
      }
    }

    // Timer má»—i lÆ°á»£t
    function startTimer() {
      timeLeft = 300;
      document.getElementById('timer').textContent = `Thá»i gian: 05:00`;
      timerInterval = setInterval(() => {
        timeLeft--;
        const min = Math.floor(timeLeft / 60);
        const sec = timeLeft % 60;
        document.getElementById('timer').textContent = `Thá»i gian: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          endGame(currentTurn === 1 ? 'Tráº¯ng tháº¯ng (Äen háº¿t giá»)' : 'Äen tháº¯ng (Tráº¯ng háº¿t giá»)');
        }
      }, 1000);
    }

    // Äáº·t quÃ¢n
    const canvas = document.getElementById('playBoard');
    canvas.addEventListener('click', (e) => {
      if (ranked && currentTurn === 2 && mode === 'ai') return; // Chá» AI náº¿u ranked
      const rect = canvas.getBoundingClientRect();
      const cellSize = canvas.width / boardSize;
      const x = Math.floor((e.clientX - rect.left) / cellSize);
      const y = Math.floor((e.clientY - rect.top) / cellSize);
      if (x >= 0 && x < boardSize && y >= 0 && y < boardSize && board[y][x] === 0) {
        // Kiá»ƒm tra Ko (minh há»a: khÃ´ng cho Ä‘áº·t láº¡i vá»‹ trÃ­ cuá»‘i cÃ¹ng)
        if (lastMove && lastMove.x === x && lastMove.y === y) {
          alert('Vi pháº¡m luáº­t Ko!');
          return;
        }
        board[y][x] = currentTurn;
        moveHistory.push({x, y, turn: currentTurn});
        lastMove = {x, y};
        document.getElementById('sfxPlace').play();
        // Minh há»a báº¯t quÃ¢n (ngáº«u nhiÃªn xÃ³a quÃ¢n lÃ¢n cáº­n náº¿u "báº¯t")
        if (Math.random() > 0.7) {
          if (x > 0 && board[y][x-1] === 3 - currentTurn) {
            board[y][x-1] = 0;
            document.getElementById('sfxCapture').play();
            if (currentTurn === 1) blackCaptures++; else whiteCaptures++;
            document.getElementById('blackCaptures').textContent = blackCaptures;
            document.getElementById('whiteCaptures').textContent = whiteCaptures;
          }
        }
        drawBoard();
        currentTurn = 3 - currentTurn;
        document.getElementById('playStatus').querySelector('.status-text').textContent = currentTurn === 1 ? 'LÆ°á»£t Äen' : 'LÆ°á»£t Tráº¯ng';
        clearInterval(timerInterval);
        startTimer();
        if (mode === 'ai' && currentTurn === 2) aiMove();
      }
    });

    // AI Move (minh há»a dá»±a trÃªn level: easy - ngáº«u nhiÃªn, pro - Æ°u tiÃªn giá»¯a)
    function aiMove() {
      let placed = false;
      while (!placed) {
        let x, y;
        if (aiLevel === 'pro' || aiLevel === 'hard') {
          x = Math.floor(boardSize / 2) + Math.floor(Math.random() * 3 - 1); // Æ¯u tiÃªn giá»¯a bÃ n
          y = Math.floor(boardSize / 2) + Math.floor(Math.random() * 3 - 1);
        } else {
          x = Math.floor(Math.random() * boardSize);
          y = Math.floor(Math.random() * boardSize);
        }
        if (board[y][x] === 0) {
          board[y][x] = 2;
          moveHistory.push({x, y, turn: 2});
          lastMove = {x, y};
          document.getElementById('sfxPlace').play();
          placed = true;
        }
      }
      drawBoard();
      currentTurn = 1;
      document.getElementById('playStatus').querySelector('.status-text').textContent = 'LÆ°á»£t Äen';
      clearInterval(timerInterval);
      startTimer();
    }

    // Pass
    document.getElementById('btnPass').addEventListener('click', () => {
      alert('Pass lÆ°á»£t!');
      currentTurn = 3 - currentTurn;
      document.getElementById('playStatus').querySelector('.status-text').textContent = currentTurn === 1 ? 'LÆ°á»£t Äen' : 'LÆ°á»£t Tráº¯ng';
      if (mode === 'ai' && currentTurn === 2) aiMove();
      // Kiá»ƒm tra náº¿u cáº£ hai pass liÃªn tiáº¿p -> káº¿t thÃºc vÃ¡n
      if (moveHistory.length > 1 && moveHistory[moveHistory.length - 1].turn === 'pass' && moveHistory[moveHistory.length - 2].turn === 'pass') endGame('Cáº£ hai pass - Káº¿t thÃºc vÃ¡n');
    });

    // Resign
    document.getElementById('btnResign').addEventListener('click', () => {
      endGame(currentTurn === 1 ? 'Äen Ä‘áº§u hÃ ng - Tráº¯ng tháº¯ng' : 'Tráº¯ng Ä‘áº§u hÃ ng - Äen tháº¯ng');
    });

    // Hint (gá»£i Ã½ náº¿u khÃ´ng ranked)
    document.getElementById('btnHint').addEventListener('click', () => {
      if (ranked) {
        alert('Hint bá»‹ táº¯t á»Ÿ cháº¿ Ä‘á»™ Ranked!');
        return;
      }
      // Minh há»a gá»£i Ã½ ngáº«u nhiÃªn
      const x = Math.floor(Math.random() * boardSize);
      const y = Math.floor(Math.random() * boardSize);
      alert(`Gá»£i Ã½: Äáº·t táº¡i (${String.fromCharCode(65 + x)}, ${boardSize - y})`);
    });

    // Undo
    document.getElementById('btnUndo').addEventListener('click', () => {
      if (moveHistory.length > 0) {
        const last = moveHistory.pop();
        board[last.y][last.x] = 0;
        currentTurn = last.turn;
        drawBoard();
        document.getElementById('playStatus').querySelector('.status-text').textContent = 'ÄÃ£ undo!';
      }
    });

    // Káº¿t thÃºc vÃ¡n vÃ  tÃ³m táº¯t
    function endGame(result) {
      clearInterval(timerInterval);
      // Minh há»a Ä‘áº¿m Ä‘iá»ƒm (ngáº«u nhiÃªn)
      const blackScore = Math.floor(Math.random() * 50 + 10) + blackCaptures + (ruleSet === 'chinese' ? komi / 2 : 0);
      const whiteScore = Math.floor(Math.random() * 50 + 10) + whiteCaptures + komi;
      const summary = `
        <p>${result}</p>
        <p>Äiá»ƒm Äen: ${blackScore} (Báº¯t: ${blackCaptures})</p>
        <p>Äiá»ƒm Tráº¯ng: ${whiteScore} (Báº¯t: ${whiteCaptures}, Komi: ${komi})</p>
        <p>Blunder: ${Math.floor(Math.random() * 5)} (Má»Ÿ rá»™ng phÃ¢n tÃ­ch thá»±c táº¿ trong js/analysis.js)</p>
      `;
      document.getElementById('postGameSummary').innerHTML = summary;
    }

    // Báº¯t Ä‘áº§u vÃ¡n khi nháº¥n btnStart
    document.getElementById('btnStart').addEventListener('click', () => {
      boardSize = parseInt(document.getElementById('boardSize').value);
      ruleSet = document.getElementById('ruleSet').value;
      komi = parseFloat(document.getElementById('komi').value);
      mode = document.getElementById('opponentType').value;
      aiLevel = document.getElementById('aiLevel').value;
      ranked = document.getElementById('rankedToggle').checked;
      showCoords = document.getElementById('showCoords').checked;
      showLiberties = document.getElementById('showLiberties').checked;
      const canvas = document.getElementById('playBoard');
      canvas.width = boardSize * 50; // Äiá»u chá»‰nh kÃ­ch thÆ°á»›c
      canvas.height = boardSize * 50;
      initBoard(boardSize);
      document.getElementById('btnHint').disabled = ranked; // Táº¯t hint náº¿u ranked
      alert('VÃ¡n báº¯t Ä‘áº§u vá»›i thiáº¿t láº­p: ' + (mode === 'ai' ? 'Vs AI (' + aiLevel + ')' : 'Vs NgÆ°á»i'));
    });
  </script>

  <script src="js/main.js" defer></script>
  <script src="js/game.js" defer></script>
  <script src="js/ai.js" defer></script>
  <script src="js/main.js" defer></script>  
  <script src="js/mainfest.json" defer></script>
  <script src="js/security.js" defer></script>
</body>
</html>
